<div id="keyboardforemail" class="customkeyboard">
    
    <div class="keyboardpromptpanel">
        <div class="emailkeyboardprompt" style="display: inline-block"></div>
        <div class="emailkeyboardentry" style="display: inline-block; margin-left: 20px; color: #fff; font-weight: 300;"></div>
    </div>

    <div class="alphakeys" id="keyboardforemailkeys">
        <div style="margin-left: 16px;">#</div>
        <div>1</div>
        <div>2</div>
        <div>3</div>
        <div>4</div>
        <div>5</div>
        <div>6</div>
        <div>7</div>
        <div>8</div>
        <div>9</div>
        <div>0</div>
            
        <div style="width:150px">backspace</div>
        <br />
        <div class="letter">_</div>
        <div class="letter">q</div>
        <div class="letter">w</div>
        <div class="letter">e</div>
        <div class="letter">r</div>
        <div class="letter">t</div>
        <div class="letter">y</div>
        <div class="letter">u</div>
        <div class="letter">i</div>
        <div class="letter">o</div>
        <div class="letter">p</div>
        <div class="letter">+</div>
            
        <br />
        <div class="letter">a</div>
        <div class="letter">s</div>
        <div class="letter">d</div>
        <div class="letter">f</div>
        <div class="letter">g</div>
        <div class="letter">h</div>
        <div class="letter">j</div>
        <div class="letter">k</div>
        <div class="letter">l</div>
        <br />
        <div class="spacer nohighlight">&nbsp;</div>
        <div class="letter">z</div>
        <div class="letter">x</div>
        <div class="letter">c</div>
        <div class="letter">v</div>
        <div class="letter">b</div>
        <div class="letter">n</div>
        <div class="letter">m</div>
        <div>.</div>
        <div class="atsignkey">&#64;</div>
        
        <br />

        
        <div class="domain">aol.com</div>
        <div class="domain">me.com</div>
        <div class="domain">msn.com</div>
        <div class="domain">live.com</div>
        <div class="domain">hotmail.com</div>
        <div class="domain">yahoo.com</div>
        <div class="domain">gmail.com</div>

        <div class="extention">.com</div>
        <div class="extention">.net</div>
        <div class="extention">.org</div>
        <div class="extention">.gov</div>
        <div class="extention">.edu</div>

    </div>
    
    <div class="clear emailkeyboardfunctionkey">clear</div>
    <div class="cancel emailkeyboardfunctionkey">cancel</div>


    <div class="okbutton emailkeyboardfunctionkey">OK</div>
    

</div>

<style>
    .keyboardpromptpanel 
    {
        position: absolute;
        font-family: Roboto;
        font-size: 18pt;
        font-weight: 100;
        margin-left: 20px;
        padding: 20px 0 0 0;
        
    }
    #keyboardforemail {
        position: fixed;
        bottom: -420px;
        left: 0px;
        width: 100%;
        height: 420px;
        background-color: #111111; /* rgba(0,0,0,1);*/
    }
    #keyboardforemail .alphakeys {
        position: absolute;
        top: 83px;
        left: 0px;
        text-align: center;
        display: inline-block;
        
    }
    #keyboardforemail .alphakeys div {
        padding: 10px 5px 10px 5px;
        margin: 1px;
        border: 1px solid rgba(255,255,255,0.5);
        min-width: 40px;
        display: inline-block;
        font-family: Roboto;
        font-size: 16pt;
        color: #fff;
        background-color: rgba(0,0,0,0.3);
        cursor: pointer;
    }
    #keyboardforemail .alphakeys div.domain {
        padding: 25px 15px 5px 15px;
        margin: 5px 1px 1px 1px;
        border: 1px solid rgba(255,255,255,0.5);
        height: 50px;
        display: none;
        font-family: Roboto;
        font-size: 16pt;
        font-weight: 100;
        color: #ffff00;
        background-color: rgba(0,0,0,0.3);
        cursor: pointer;
        
        max-width: 140px;
    }
    #keyboardforemail .alphakeys div.extention {
        padding: 25px 15px 5px 15px;
        margin: 5px 1px 1px 1px;
        border: 1px solid rgba(255,255,255,0.5);
        height: 50px;
        display: none;
        font-family: Roboto;
        font-size: 16pt;
        font-weight: 100;
        color: #ffff00;
        background-color: rgba(0,0,0,0.3);
        cursor: pointer;
        max-width: 140px;
    }
    #keyboardforemail .alphakeys div.spacer {
        padding: 20px 10px 10px 10px;
        margin: 1px;
        border: none;
        width: 60px;
        height: 50px;
        display: inline-block;
        font-family: Arial;
        font-size: 24pt;
        color: #fff;
        cursor: default;
        background-color: rgba(0,0,0,0);
    }
    
    #keyboardforemail .alphakeys div.space {
        padding: 20px 10px 10px 10px;
        margin: 3px;
        border: 1px solid rgba(255,255,255,0.5);
        width: 500px;
        height: 50px;
        display: inline-block;
        font-family: Arial;
        font-size: 24pt;
        color: #fff;
        background-color: rgba(0,0,0,0.3);
        
    }

    #keyboardforemail .numerickeys {
        position: absolute;
        top: 20px;
        right: 20px;
        text-align: center;
        display: inline-block;
        margin-left: 100px;
    }
    #keyboardforemail .numerickeys div {
        padding: 20px 10px 10px 10px;
        margin: 1px;
        border: 1px solid rgba(255,255,255,0.5);
        width: 60px;
        height: 50px;
        display: inline-block;
        font-family: Arial;
        font-size: 24pt;
        color: #fff;
        background-color: rgba(0,0,0,0.3);
        
    }
    
    .emailkeyboardfunctionkey 
    {
        position: absolute;
        padding: 25px 10px 2px 10px;
        margin: 1px;
        border: 1px solid rgba(255,255,255,0.5);
        width: 160px;
        height: 50px;
        display: inline-block;
        font-family: Roboto;
        font-size: 16pt;
        font-weight: 100;
        text-align: center;
        color: #fff;
        background-color: rgba(0,0,0,0.3);
    }
    
    #keyboardforemail .clear { top: 83px; right:20px; }
    #keyboardforemail .cancel { bottom: 0px; left: 0px; }
    #keyboardforemail .okbutton { bottom: 0px; right: 0px; }
        
    .highlightedbutton 
    {
        background: #0099ff; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwOTlmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDgzZGIiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top,  #0099ff 0%, #0083db 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#0099ff), color-stop(100%,#0083db)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  #0099ff 0%,#0083db 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  #0099ff 0%,#0083db 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  #0099ff 0%,#0083db 100%); /* IE10+ */
        background: linear-gradient(to bottom,  #0099ff 0%,#0083db 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#0099ff', endColorstr='#0083db',GradientType=0 ); /* IE6-8 */    
        border: none;
    }
    .highlightedbutton:active  { background: white; color: black; }  
</style>

<script>

    var keyboardforemailloaded = false;
    var keyboardforemail_field = null;
    var emailkeyboarddomainkeypressed = false;
    var emailkeyboardextentionkeypressed = false;
    var emailkeyboardoriginalstring = '';
    
    function showKeyboardForEmail(field) {

        $('.customkeyboard').hide();

        $('.cancel').css('background-color', 'rgba(0,0,0,0.3)'); 
        $('.cancel').css('color', '#fff');

        
        $('#keyboardforemail .alphakeys').css('left',  143);

        $('#keyboardforemail').show();
        playSound(sfxbreeze);
        $('#keyboardforemail').animate({ bottom : 0 }, 400);

        keyboardforemail_field = field;

        $('.emailkeyboardprompt').html($(keyboardforemail_field).attr('prompt'));
        emailkeyboardoriginalstring = $(keyboardforemail_field).html();
        updateEmailKeyboardEntry(emailkeyboardoriginalstring);
        
        $(keyboardforemail_field).css('border', 'thin solid rgba(255, 255, 255, 1)');

        if (!keyboardforemailloaded) {

            var fn_touchstart = function () {
                if (!$(this).hasClass('nohighlight')) {
                    $(this).css('background-color', '#fff'); $(this).css('color', '#000');
                }
                if (!$(this).hasClass('noaction')) {
                    processEmailKeyboardKey(this);
                }
            };
            var fn_touchend = function () {
                if (!$(this).hasClass('nohighlight')) {
                    $(this).css('background-color', 'rgba(0,0,0,0.3)'); $(this).css('color', '#fff');
                }
            };

            if (getCookie('istouchscreen') === '1') {
                $('#keyboardforemail .alphakeys div').on({ 'touchstart': fn_touchstart });
                $('#keyboardforemail .alphakeys div').on({ 'touchend': fn_touchend });

                $('.emailkeyboardfunctionkey').on({ 'touchstart': fn_touchstart });
                $('.emailkeyboardfunctionkey').on({ 'touchend': fn_touchend });

            }
            else {
                //For NON-TOUCH mouse click support
                $('#keyboardforemail .alphakeys div').on({ 'mousedown': fn_touchstart });
                $('#keyboardforemail .alphakeys div').on({ 'mouseup': fn_touchend });

                $('.emailkeyboardfunctionkey').on({ 'mousedown': fn_touchstart });
                $('.emailkeyboardfunctionkey').on({ 'mouseup': fn_touchend });

            }
            keyboardforemailloaded = true;
        }

        $('#keyboardbackground').show();
        $('#keyboardbackground').animate({ "opacity": 1 }, 1000);
    }

    function processEmailKeyboardKey(key) {

        if ($(key).hasClass('emailkeyboardfunctionkey')) {
            processEmailKeyboardFunctionKey(key);
            return;
        }

        var currentstring = $(keyboardforemail_field).html();
        var newstring = currentstring;

        var char = $(key).html();
        
        switch ($.trim(char)) {
            case '&nbsp;':
                break;
            case 'backspace':
                var backspacedone = false;
                if (emailkeyboarddomainkeypressed) {
                    var domainkeys = $('.domain');
                    for (var i = 0; i < domainkeys.length; i++) {
                        if (newstring.indexOf($(domainkeys[i]).html()) > 0) {
                            newstring = newstring.replace($(domainkeys[i]).html(), '');
                            emailkeyboarddomainkeypressed = false;
                            backspacedone = true;
                            playSound(sfxarrow);
                            break;
                        }
                    }
                }
                if (emailkeyboardextentionkeypressed) {
                    var extentionkeys = $('.extention');
                    for (var i = 0; i < extentionkeys.length; i++) {
                        if (newstring.indexOf($(extentionkeys[i]).html()) > 0) {
                            newstring = newstring.replace($(extentionkeys[i]).html(), '');
                            emailkeyboardextentionkeypressed = false;
                            backspacedone = true;
                            playSound(sfxarrow);
                            break;
                        }
                    }
                }
                if (!backspacedone) {
                    if (newstring.length > 0) {
                        newstring = newstring.substring(0, newstring.length - 1);
                        playSound(sfxarrow);
                    }
                }
                break;
            default:
                if (!emailkeyboarddomainkeypressed && !emailkeyboardextentionkeypressed) {
                    if (char == '@@') {
                        if (currentstring.length == 0) {
                            $(key).css('background-color', '#ff0000'); $(this).css('color', '#000');
                            playSound(sfxerror);
                        }
                        else {
                            playSound(sfxbreeze);
                            newstring += char;
                        }
                    }
                    else {
                        playSound(sfxclick);
                        newstring += char;
                    }
                }
                break;
        }

        if ($(key).hasClass('domain')) {
            emailkeyboarddomainkeypressed = true;
        }

        if ($(key).hasClass('extention')) {
            emailkeyboardextentionkeypressed = true;
        }

        updateEmailKeyboardEntry(newstring);

        doEmailKeyboardPostKeyProcessing();
    }

    function updateEmailKeyboardEntry(newstring) {
        
        $(keyboardforemail_field).html(newstring);
        $(keyboardforemail_field).val(newstring);

        if (validateEmail(newstring)) {
            $('.emailkeyboardentry').html(newstring + '<img src="/content/images/kiosk/importantthings/check.png" style="width:35px; margin-left: 20px;" />');
        }
        else {
            $('.emailkeyboardentry').html(newstring);
        }
    }

    function processEmailKeyboardFunctionKey(key) {

        var currentstring = $(keyboardforemail_field).html();
        var newstring = currentstring;

        var char = $(key).html();

        switch ($.trim(char).toLowerCase()) {
            case '&nbsp;':
                break;
            case 'clear':
                emailkeyboarddomainkeypressed = false;
                emailkeyboardextentionkeypressed = false;
                newstring = '';
                playSound(sfxvoltage);
                break;
            case 'cancel':
                emailkeyboarddomainkeypressed = false;
                emailkeyboardextentionkeypressed = false;
                updateEmailKeyboardEntry(emailkeyboardoriginalstring);

                $('.cancel').css('background-color', 'rgba(0,0,0,0.3)'); $('.cancel').css('color', '#fff');
                dismissKeyboardForEmail();
                return;
            case 'ok':
                emailkeyboarddomainkeypressed = false;
                emailkeyboardextentionkeypressed = false;

                if (validateEmail(newstring)) {
                    $('.okbutton').css('background-color', 'rgba(0,0,0,0.3)'); $('.okbutton').css('color', '#fff');
                    dismissKeyboardForEmail();
                }
                else {
                    //$('.okbutton').css('background-color', 'rgba(0,0,0,0.3)'); $('.okbutton').css('color', '#fff');
                    //dismissKeyboardForEmail();
                    playSound(sfxerror);
                }
                return;
                
        }

        updateEmailKeyboardEntry(newstring);

        doEmailKeyboardPostKeyProcessing();
    }

    function doEmailKeyboardPostKeyProcessing() {

        var string = $(keyboardforemail_field).html();

        if (string.indexOf('@@') >= 0) {

            //At sign pressed 

            $('.atsignkey').css('background-color', 'rgba(0,0,0,0.3)');
            $('.atsignkey').css('color', 'rgba(255,255,0,1)');
            $('.atsignkey').addClass('nohighlight');
            $('.atsignkey').addClass('noaction');

            if (string[string.length - 1] === '@@') {
                $('.domain').css('display', 'inline-block');
                $('.domain').css('background-color', 'rgba(0,0,0,0.3)');
                $('.domain').css('color', '#ffff00');

                $('.extention').css('display', 'none');
            }
            else {
                $('.extention').css('display', 'inline-block');
                $('.extention').css('background-color', 'rgba(0,0,0,0.3)');
                $('.extention').css('color', '#ffff00');

                $('.domain').css('display', 'none');
            }

        }
        else {
            $('.atsignkey').css('color', 'rgba(255,255,255,1)');
            $('.atsignkey').removeClass('nohighlight');
            $('.atsignkey').removeClass('noaction');

            $('.domain').css('display', 'none');
            $('.extention').css('display', 'none');
        }

        if (emailkeyboarddomainkeypressed) {
            $('.domain').css('display', 'none');
            $('.extention').css('display', 'none');
        }
        if (emailkeyboardextentionkeypressed) {
            $('.domain').css('display', 'none');
            $('.extention').css('display', 'none');
        }

        if (validateEmail(string)) {
            $('.okbutton').addClass('highlightedbutton');
        }
        else {
            $('.okbutton').removeClass('highlightedbutton');
        }

    }
    function dismissKeyboardForEmail() {
        $(keyboardforemail_field).css('border', 'thin solid rgba(255, 255, 255, 1)');
        keyboardforemail_field = null;
        emailkeyboarddomainkeypressed = false;
        emailkeyboardextentionkeypressed = false;
        playSound(sfxwhoosh);
        $('#keyboardforemail').animate({ bottom: '-' + $('#keyboardforemail').css('height') }, 250);

        $('#keyboardbackground').css("opacity", 0);
        $('#keyboardbackground').hide();
    }
</script>
